angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$rootElement","$window","$timeout","$sce",function(a,b,c,d,e,f){function g(){var a=(Math.round(127*Math.random())+127).toString(16),b=(Math.round(127*Math.random())+127).toString(16),c=(Math.round(127*Math.random())+127).toString(16);return"#"+a+b+c}function h(a,b){var c=null;for(var d in a)if(angular.isElement(a[d])&&(c=angular.element(a[d]),c.hasClass(b)))return c;return c}function i(c,i){function k(){if(l()){o(),p(),m(),n();var a=q(X);a(),J()}}function l(){if(P&&O)return!0;if(N.waitForHeightAndWidth)return!1;throw new Error("Please set height and width for the chart element")}function m(){if(!N.legend.display)return T=P,void(U=O);switch(N.legend.position){case"top":case"bottom":T=.75*P,U=O;break;case"left":case"right":T=P,U=.75*O}}function n(){var d=a.get("angularChartsTemplate_"+N.legend.position);i.html(d),b(i.contents())(c);var e=i.find("div");V=h(e,"ac-chart"),W=h(e,"ac-legend"),T-=h(e,"ac-title")[0].clientHeight}function o(){c.acConfig&&angular.extend(N,c.acConfig)}function p(){Q=c.acData,X=c.acChart,R=Q?Q.series||[]:[],S=Q?Q.data||[]:[]}function q(a){var b={pie:E,bar:B,line:C,area:D,point:F};return b[a]}function r(a,b){var c=b.domain();if(N.xAxisMaxTicks&&c.length>N.xAxisMaxTicks){var d=Math.ceil(c.length/N.xAxisMaxTicks);a.tickValues(c.filter(function(a,b){return b%d===0}))}}function s(a,b){var c=N.yAxisFixedScale;if(angular.isUndefined(c)||angular.isUndefined(c.min)||angular.isUndefined(c.max)){var d=.2*d3.max(b);a.domain([d3.min(b),d3.max(b)+d])}else a.domain([c.min,c.max])}function t(a,b){return d3.select(V[0]).append("svg").attr("width",U+a.left+a.right).attr("height",T+a.top+a.bottom).append("g").attr("transform","translate("+("right"===b?a.right:a.left)+","+a.top+")")}function u(a,b){a.append("g").attr("class","x axis").attr("transform","translate(0,"+T+")").call(b)}function v(a,b){a.append("g").attr("class","y axis").attr("transform","translate("+("right"===b.orient()?U:0)+",0)").call(b)}function w(a,b){var c=0;if(b>0)for(var d=b;d>0;d--)c+=x(a,d-1);return a(0)+c}function x(a,b){var c=null;return b<N.barWidths.length?N.barWidths[b]:null==c?a.rangeBand():c}function y(a,b){for(var c=0,d=0;a>d;d++)c+=x(b,d);return c}function z(a,b,c){var d=b.nicedata.length,e=y(d,c);return a(b.x)+(c.rangeBand()*d-e)/2}function A(a){return a+N.labelUnit}function B(){var a={top:0,right:20,bottom:30,left:40};U-=a.left+a.right,T-=a.top+a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,U],.1),d=d3.scale.linear().range([T,10]),e=d3.scale.ordinal().rangeRoundBands([0,U],.1),f=[0];S.forEach(function(a){a.nicedata=a.y.map(function(b,c){return f.push(b),{x:a.x,y:b,s:c,tooltip:angular.isArray(a.tooltip)?a.tooltip[c]:a.tooltip}})});var g=d3.max(S.map(function(a){return a.y.length}));c.yMaxData=g,b.domain(S.map(function(a){return a.x})),s(d,f),e.domain(d3.range(g)).rangeRoundBands([0,b.rangeBand()]);var h=d3.svg.axis().scale(b).orient("bottom");r(h,b);var i=d3.svg.axis().scale(d).orient(N.yAxisOrientation).ticks(10).tickFormat(d3.format(N.yAxisTickFormat));N.yAxisGridLine&&i.tickSize(-U);var j=t(a,i.orient());u(j,h),v(j,i);var k=j.selectAll(".state").data(S).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+z(b,a,e)+",0)"}),l=k.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");l.attr("width",function(a){return x(e,a.s)}),l.attr("x",function(a,b){return w(e,b)}).attr("y",T).style("fill",function(a){return M(a.s)}).attr("height",0).transition().ease("cubic-in-out").duration(N.isAnimate?N.animationDuration:0).attr("y",function(a){return d(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(d(a.y)-d(0))}),l.on("mouseover",function(a){G({index:a.x,value:a.tooltip?a.tooltip:a.y,series:R[a.s]},d3.event),N.mouseover(a,d3.event),c.$apply()}).on("mouseleave",function(a){H(),N.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(a){I(a,d3.event)}).on("click",function(a){N.click.call(a,d3.event),c.$apply()}),N.labels&&k.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("class","valueLabel").attr("text-anchor","middle").attr("x",function(a,b){var c=w(e,b),d=x(e,b);return c+d/2}).attr("y",function(a){var b=N.labelsRelativeY,c=T-Math.abs(d(a.y)-d(0))-b;return c>=T?T-2:c}).text(function(a){return A(a.y)}),j.append("line").attr("class","zero-line").attr("x1",U).attr("y1",d(0)).attr("y2",d(0))}function C(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};U-=b.left+b.right,T-=b.top+b.bottom;var d=d3.scale.ordinal().domain(S.map(function(a){return a.x})).rangeRoundBands([0,U]),e=d3.scale.linear().range([T,10]),f=d3.svg.axis().scale(d).orient("bottom");r(f,d);var g=d3.svg.axis().scale(e).orient(N.yAxisOrientation).ticks(5).tickFormat(d3.format(N.yAxisTickFormat));N.yAxisGridLine&&g.tickSize(-U);var h=d3.svg.line().interpolate(N.lineCurveType).x(function(b){return a(b.x)}).y(function(a){return e(a.y)}),i=[0],j=[];S.forEach(function(a){a.y.map(function(a){i.push(a)})});var k=d3.max(S.map(function(a){return a.y.length}));c.yMaxData=k,R.slice(0,k).forEach(function(a,b){var c={};c.series=a,c.values=S.map(function(a){return a.y.map(function(b){return{x:a.x,y:b,tooltip:a.tooltip}})[b]||{x:S[b].x,y:0}}),j.push(c)}),s(e,i);var l=t(b,g.orient());u(l,f),v(l,g);var m=l.selectAll(".points").data(j).enter().append("g"),n=m.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return M(b)}).attr("d",function(a){return h(a.values)}).attr("stroke-width","2").attr("fill","none");if(j.length>0){var o=j[j.length-1].values;if(o.length>0){var p=n.node().getTotalLength()+a(o[o.length-1].x);n.attr("stroke-dasharray",p+" "+p).attr("stroke-dashoffset",p).transition().duration(N.isAnimate?N.animationDuration:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return h(a.values)})}}return angular.forEach(j,function(b){var d=l.selectAll(".circle").data(b.values).enter();d.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return e(a.y)}).attr("r",3).style("fill",M(j.indexOf(b))).style("stroke",M(j.indexOf(b))).on("mouseover",function(a){return function(b){G({index:b.x,value:b.tooltip?b.tooltip:b.y,series:a},d3.event),N.mouseover(b,d3.event),c.$apply()}}(b.series)).on("mouseleave",function(a){H(),N.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(){I(d3.event)}).on("click",function(a){N.click(a,d3.event),c.$apply()}),N.labels&&d.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return e(a.y)}).attr("class","valueLabel").text(function(a){return A(a.y)})}),"lineEnd"===N.lineLegend&&m.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(b){return"translate("+a(b.value.x)+","+e(b.value.y)+")"}).attr("x",3).text(function(a){return a.name}),j}function D(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};U-=b.left+b.right,T-=b.top+b.bottom;var d=d3.scale.ordinal().domain(S.map(function(a){return a.x})).rangePoints([0,U]),e=d3.scale.linear().range([T,10]),f=d3.svg.axis().scale(d).orient("bottom");r(f,d);var g=d3.svg.axis().scale(e).orient(N.yAxisOrientation).ticks(5).tickFormat(d3.format(N.yAxisTickFormat));N.yAxisGridLine&&g.tickSize(-U),d3.svg.line().interpolate(N.lineCurveType).x(function(b){return a(b.x)}).y(function(a){return e(a.y)});var h=[0],i=[];S.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(S.map(function(a){return a.y.length}));c.yMaxData=j,R.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=S.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:S[b].x,y:0}}),i.push(c)}),s(e,h);var k=t(b,g.orient());u(k,f),v(k,g);var l=k.selectAll(".points").data(i).enter().append("g"),m=d3.svg.area().interpolate("basis").x(function(b){return a(b.x)}).y0(function(){return e(0)}).y1(function(a){return e(0+a.y)});l.append("path").attr("class","area").attr("d",function(a){return m(a.values)}).style("fill",function(a,b){return M(b)}).style("opacity","0.7")}function E(){function a(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return g(b(a))}}var b=Math.min(U,T)/2,d=d3.select(V[0]).append("svg").attr("width",U).attr("height",T).append("g").attr("transform","translate("+U/2+","+T/2+")"),e=0;if(N.innerRadius){var f=N.innerRadius;f="string"==typeof f&&f.indexOf("%")>0?.01*b*parseFloat(f):Number(f),f>=0&&(e=f)}c.yMaxData=S.length;var g=d3.svg.arc().outerRadius(b-10).innerRadius(e);d3.svg.arc().outerRadius(b+5).innerRadius(0);var h=d3.layout.pie().sort(null).value(function(a){return a.y[0]}),i=d.selectAll(".arc").data(h(S)).enter().append("g"),j=!1;i.append("path").style("fill",function(a,b){return M(b)}).transition().ease("linear").duration(N.isAnimate?N.animationDuration:0).attrTween("d",a).attr("class","arc").each("end",function(){j||(j=!0,i.on("mouseover",function(a){G({value:a.data.tooltip?a.data.tooltip:a.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),N.mouseover(a,d3.event),c.$apply()}).on("mouseleave",function(a){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),H(),N.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(a){I(a,d3.event)}).on("click",function(a){N.click(a,d3.event),c.$apply()}))}),N.labels&&i.append("text").attr("transform",function(a){return"translate("+g.centroid(a)+")"}).attr("class","valueLabel").attr("dy",".35em").style("text-anchor","middle").text(function(a){return A(a.data.y[0])})}function F(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};U-=b.left-b.right,T-=b.top-b.bottom;var d=d3.scale.ordinal().domain(S.map(function(a){return a.x})).rangeRoundBands([0,U]),e=d3.scale.linear().range([T,10]),f=d3.svg.axis().scale(d).orient("bottom");r(f,d);var g=d3.svg.axis().scale(e).orient(N.yAxisOrientation).ticks(5).tickFormat(d3.format(N.yAxisTickFormat));N.yAxisGridLine&&g.tickSize(-U);var h=[0],i=[];S.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(S.map(function(a){return a.y.length}));c.yMaxPoints=j,R.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=S.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:S[b].x,y:0}}),i.push(c)}),s(e,h);var k=t(b,g.orient());u(k,f),v(k,g),k.selectAll(".points").data(i).enter().append("g"),angular.forEach(i,function(b){var d=k.selectAll(".circle").data(b.values).enter();d.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return e(a.y)}).attr("r",3).style("fill",M(i.indexOf(b))).style("stroke",M(i.indexOf(b))).on("mouseover",function(a){return function(b){G({index:b.x,value:b.tooltip?b.tooltip:b.y,series:a},d3.event),N.mouseover(b,d3.event),c.$apply()}}(b.series)).on("mouseleave",function(a){H(),N.mouseout(a,d3.event),c.$apply()}).on("mousemove",function(){I(d3.event)}).on("click",function(a){N.click(a,d3.event),c.$apply()}),N.labels&&d.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return e(a.y)}).attr("class","valueLabel").text(function(a){return A(a.y)})})}function G(a,b){if(N.tooltips){a="function"==typeof N.tooltips?N.tooltips(a):a.value;var d=angular.element('<p class="ac-tooltip"></p>').html(a).css({left:b.pageX+20+"px",top:b.pageY-30+"px"});angular.element(document.querySelector(".ac-tooltip")).remove(),angular.element(document.body).append(d),c.$tooltip=d}}function H(){c.$tooltip&&c.$tooltip.remove()}function I(a,b){c.$tooltip&&c.$tooltip.css({left:b.pageX+20+"px",top:b.pageY-30+"px"})}function J(){c.legends=[],"pie"===X&&angular.forEach(S,function(a,b){c.legends.push({color:N.colors[b],title:L(a.x)})}),("bar"===X||"area"===X||"point"===X||"line"===X&&"traditional"===N.lineLegend)&&angular.forEach(R,function(a,b){c.legends.push({color:N.colors[b],title:L(a)})})}function K(a){return String(a).replace(/[&<>"'\/]/g,function(a){return Y[a]})}function L(a){return f.trustAsHtml(N.legend.htmlEnabled?a:K(a))}function M(a){if(a<N.colors.length)return N.colors[a];var b=g();return N.colors.push(b),b}var N={title:"",tooltips:!0,labels:!1,labelsRelativeY:0,labelUnit:"",mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left",htmlEnabled:!1},colors:j,innerRadius:0,lineLegend:"lineEnd",lineCurveType:"cardinal",isAnimate:!0,animationDuration:1e3,yAxisTickFormat:"s",yAxisGridLine:!1,waitForHeightAndWidth:!1,yAxisFixedScale:{},yAxisOrientation:"left",barWidths:[]};o();var O=i[0].clientWidth,P=i[0].clientHeight;l();var Q,R,S,T,U,V,W,X,Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},Z=angular.element(d),$=null;Z.bind("resize",function(){$&&e.cancel($),$=e(function(){O=i[0].clientWidth,P=i[0].clientHeight,k()},100)}),c.getWindowDimensions=function(){return{h:Z[0].clientHeight,w:Z[0].clientWidth}},c.$watch("[acChart, acData, acConfig]",k,!0),c.$watch(function(){return{w:i[0].clientWidth,h:i[0].clientHeight}},function(a){O=a.w,P=a.h,k()},!0)}var j=["rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)"];return{restrict:"EA",link:i,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),function(){var a=".angular-charts-template .axis path,.angular-charts-template .axis line{fill:none;stroke:#333}.angular-charts-template .ac-title{font-weight:700;font-size:1.2em}.angular-charts-template .ac-chart{float:left;width:75%}.angular-charts-template .ac-line{fill:none;stroke-width:2px}.angular-charts-template table{float:left;max-width:25%;list-style:none;margin:0;padding:0}.angular-charts-template td[ng-bind]{display:inline-block}.angular-charts-template .ac-legend-box{border-radius:5px;height:15px;width:15px}.ac-tooltip{display:block;position:absolute;border:2px solid rgba(51,51,51,.9);background-color:rgba(22,22,22,.7);border-radius:5px;padding:5px;color:#fff}",b=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet)b.styleSheet.disabled||(b.styleSheet.cssText=a);else try{b.innerHTML=a}catch(c){b.innerText=a}}(),angular.module("angularChartsTemplates",["angularChartsTemplate_left","angularChartsTemplate_right"]),angular.module("angularChartsTemplate_left",[]).run(["$templateCache",function(a){a.put("angularChartsTemplate_left",'<div class="angular-charts-template"><div class="ac-title" ng-if="acConfig.title !== false">{{acConfig.title}}</div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div><div class="ac-chart"></div></div>')}]),angular.module("angularChartsTemplate_right",[]).run(["$templateCache",function(a){a.put("angularChartsTemplate_right",'<div class="angular-charts-template"><div class="ac-title" ng-if="acConfig.title !== false">{{acConfig.title}}</div><div class="ac-chart"></div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends | limitTo:yMaxData"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div></div>')}]);